name: Limpar Branch Auto-PR

on:
  pull_request:
    types: [closed] 

permissions:
  contents: write  

jobs:
  cleanup-auto-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT_TOKEN }}

      - name: Configurar Git
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

      - name: Deletar branch auto-pr remota
        run: |
          BRANCH_NAME="${{ github.event.pull_request.head.ref }}"
          MERGED="${{ github.event.pull_request.merged }}"

          echo "üßæ Branch recebida: $BRANCH_NAME"
          echo "üîÄ PR mergeado? $MERGED"

          if [[ "$BRANCH_NAME" == auto-pr* ]]; then
            echo "üöÄ Tentando deletar branch remota: $BRANCH_NAME"
            git push origin --delete "$BRANCH_NAME" && \
              echo "‚úÖ Branch $BRANCH_NAME deletada com sucesso." || \
              echo "‚ùå Falha ao deletar branch remota."
          else
            echo "‚ö†Ô∏è Branch $BRANCH_NAME n√£o √© auto-pr. Nada a fazer."
          fi